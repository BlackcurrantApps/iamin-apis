swagger: '2.0'
info:
  description: API Backend for the IAMIN App
  version: 1.0.0
  title: IAMIN API
  contact:
    email: sanket@blackcurrantapps.com
host: 2-dot-iamin-events.appspot.com
basePath: /_ah/api
tags:
  - name: AppUser
    description: Everything done by AppUsers
  - name: PR
    description: Everything done by PR
  - name: Manager
    description: Everything done by Manager
  - name: SuperAdmin
    description: Everything done by SuperAdmin
schemes:
  - https
security:
  - GoogleAuth: []
securityDefinitions:
  GoogleAuth:
    type: apiKey
    in: header
    name: Authorization
produces:
  - application/json
  
  
paths:
  /appUserApi/v1/getAppVersion:
    get:
      summary: Register a new app user
      operationId: getAppVersion
      security:
        - GoogleAuth: []
      tags:
        - AppUser
      responses:
        200:
          description: OK
          schema:
            type: object
            title: AppVersion
            properties:
              latestAppVersion:
                type: integer
                format: int32
              lastSupportedAppVersion:
                type: integer
                format: int32
    
  /appUserApi/v1/getAppPopup:
    get:
      summary: Get the current application popup
      operationId: getAppPopup
      security:
        - GoogleAuth: []
      tags:
        - AppUser
      responses:
        200:
          description: OK
          schema:
            type: object
            title: AppPopup
            properties:
              picture_url:
                type: string
              updateTimestamp:
                type: integer
                format: int64

  /appUserApi/v1/register:
    post:
      summary: Register a new App User
      operationId: register
      security:
        - GoogleAuth: []
      tags:
        - AppUser
      consumes: 
        - application/json
      parameters:
        - name: AppUser
          in: body
          required: true
          schema:
            type: object
            properties:
              id:
                type: string
                description: email id of the user
              contactNo:
                type: string
              name:
                type: string
              gender:
                type: boolean
                description: 1 for male 0 for female
              Institution:
                type: string
              city:
                type: string
              intrests:
                type: array
                items:
                  type: string
              profilePic:
                type: string
                description: url to the profile picture
              regId:
                type: string
                description: Google Cloud Messaging Registration ID
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/AppUser'
            
  /appUserApi/v1/getUser:
    get:
      summary: Get registered app user
      operationId: getUser
      security:
        - GoogleAuth: []
      tags:
        - AppUser
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/AppUser'
            
  /appUserApi/v1/getOffers:
    get:
      summary: Get offers displayed on the app
      operationId: getOffers
      security:
        - GoogleAuth: []
      tags:
        - AppUser
      responses:
        '200':
          description: OK
          schema:
            type: object
            properties:
              items:
                type: array
                items:
                  $ref: '#/definitions/Offer'
                  
  /appUserApi/v1/getSortedMainListings:
    get:
      summary: get sorted Main Events
      operationId: getMainEvents
      security:
        - GoogleAuth: []
      tags:
        - AppUser
      parameters:
        - name: city
          type: string
          required: true
          in: query
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/SortedMainEvents'
            
  /appUserApi/v1/getEvents:
    get:
      summary: get events inside a category
      operationId: getEvents
      security:
        - GoogleAuth: []
      tags:
        - AppUser
      parameters:
        - name: categoryId
          type: integer
          format: int64
          required: true
          in: query
      responses:
        '200':
          description: OK
          schema:
            type: object
            properties:
              items:
                type: array
                items:
                  $ref: '#/definitions/Event'
                  
  /appUserApi/v1/getEvent:
    get:
      summary: get events inside a category
      operationId: getEvent
      security:
        - GoogleAuth: []
      tags:
        - AppUser
      parameters:
        - name: eventID
          type: integer
          format: int64
          required: true
          in: query
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/Event'
            
  /appUserApi/v1/getIAMINS:
    get:
      summary: get iamins of a user
      operationId: getIAMINS
      security:
        - GoogleAuth: []
      tags:
        - AppUser
      responses:
        '200':
          description: OK
          schema:
            type: object
            properties:
              items:
                type: array
                items:
                  $ref: '#/definitions/IAMIN'
                  
  /appUserApi/v1/iamin:
    post:
      summary: IAMIN in an event
      operationId: iamin
      security:
        - GoogleAuth: []
      tags:
        - AppUser
      parameters:
        - name: eventId
          type: integer
          format: int64
          required: true
          in: query
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/IAMIN'
            
  /appUserApi/v1/getIAMIN:
    get:
      summary: get by IAMIN ID
      operationId: getIAMIN
      security:
        - GoogleAuth: []
      tags:
        - AppUser
      parameters:
        - name: iaminID
          type: integer
          format: int64
          required: true
          in: query
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/IAMIN'
            
  /appUserApi/v1/deleteIAMIN:
    delete:
      summary: Delete IAMIN
      operationId: deleteIAMIN
      security:
        - GoogleAuth: []
      tags:
        - AppUser
      parameters:
        - name: eventId
          type: integer
          format: int64
          required: true
          in: query
      responses:
        '200':
          description: OK
          
  /appUserApi/v1/getTickets:
    get:
      summary: get Tickets of a user
      operationId: getTickets
      security:
        - GoogleAuth: []
      tags:
        - AppUser
      responses:
        '200':
          description: OK
          schema:
            type: object
            properties:
              items:
                type: array
                items:
                  $ref: '#/definitions/Ticket'
                  
  /appUserApi/v1/getTicket:
    get:
      summary: get Tickets of a user
      operationId: getTicket
      security:
        - GoogleAuth: []
      tags:
        - AppUser
      parameters: 
        - name: ticketID
          type: integer
          format: int64
          in: query
          required: true
      responses:
        '200':
          description: OK
          schema:
            type: object
            properties:
              items:
                type: array
                items:
                  $ref: '#/definitions/Ticket'
                  
  /appUserApi/v1/getUserRoles:
    get:
      summary: get priviledges for a user
      operationId: getUserRoles
      security:
        - GoogleAuth: []
      tags:
        - AppUser
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/UserRoles'
            
  /appUserApi/v1/updateContactPreference:
    put:
      summary: update contact preferences on an iamin
      description: set whether or not the user wants to share contact details.
      operationId: updateContactPreference
      security:
        - GoogleAuth: []
      tags:
        - AppUser
      parameters: 
        - name: iaminId
          type: integer
          format: int64
          in: query
          required: true
        - name: canContact
          type: string
          in: query
          required: true
          enum:
            - "true"
            - "false"
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/IAMIN'
            
  /appUserApi/v1/setIaminQuantity:
    put:
      summary: Set quantity of tickets wanted
      operationId: setIaminQuantity
      security:
        - GoogleAuth: []
      tags:
        - AppUser
      parameters: 
        - name: iaminId
          type: integer
          format: int64
          in: query
          required: true
        - name: canContact
          type: boolean
          in: query
          required: true
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/IAMIN'
            
  /appUserApi/v1/getHistory:
    get:
      summary: get history of transactions for a user
      operationId: getHistory
      security:
        - GoogleAuth: []
      tags:
        - AppUser
      responses:
        '200':
          description: OK
          schema:
            type: object
            properties:
              items:
                type: array
                items:
                  $ref: '#/definitions/EventLog'
                  
  /appUserApi/v1/getPRLocations:
    get:
      summary: get prs for a event along with their locations
      operationId: getPRLocations
      security:
        - GoogleAuth: []
      tags:
        - AppUser
      parameters: 
        - name: mainEventID
          type: integer
          format: int64
          in: query
          required: true
      responses:
        '200':
          description: OK
          schema:
            type: object
            title: LocationContainer
            properties:
              mainEventLat:
                type: number
                format: double
              mainEventLon:
                type: number
                format: double
              prLocations:
                type: array
                items:
                  type: object
                  title: PRLocation
                  properties:
                    lat:
                      type: number
                      format: double
                    lon:
                      type: number
                      format: double
                    appUser:
                      $ref: '#/definitions/AppUser'
                  
  /appUserApi/v1/PostEventFeedback:
    post:
      summary: post feedback on a event
      operationId: PostEventFeedback
      security:
        - GoogleAuth: []
      tags:
        - AppUser
      parameters: 
        - name: eventID
          type: integer
          format: int64
          in: query
          required: true
        - name: Message
          type: string
          in: query
          required: true
        - name: Rating
          type: integer
          format: int32
          in: query
          minimum: 1
          maximum: 5
      responses:
        '200':
          description: OK
                  
  /appUserApi/v1/postComment:
    post:
      summary: Post comment on a event
      operationId: postComment
      security:
        - GoogleAuth: []
      tags:
        - AppUser
      parameters: 
        - name: eventID
          type: integer
          format: int64
          in: query
          required: true
        - name: Message
          type: string
          in: query
          required: true
        - name: Rating
          type: integer
          format: int32
          in: query
          minimum: 1
          maximum: 5
      responses:
        '200':
          description: OK
        
  /appUserApi/v1/getCommentsForEvent:
    get:
      summary: get Comments on a Event
      operationId: getCommentsForEvent
      security:
        - GoogleAuth: []
      tags:
        - AppUser
      parameters:
        - name: eventID
          type: integer
          format: int64
          required: true
          in: query
      responses:
        '200':
          description: OK
          schema:
            type: object
            properties:
              items:
                type: array
                items:
                  $ref: '#/definitions/Comment'
                  
  /appUserApi/v1/getVotingCandidates:
    get:
      summary: get Voting candidates on a event if enabled
      operationId: getVotingCandidates
      security:
        - GoogleAuth: []
      tags:
        - AppUser
      parameters:
        - name: eventID
          type: integer
          format: int64
          required: true
          in: query
      responses:
        '200':
          description: OK
          schema:
            type: object
            properties:
              items:
                type: array
                items:
                  $ref: '#/definitions/Candidate'
                  
  /appUserApi/v1/castVote:
    post:
      summary: Cast a vote
      operationId: castVote
      security:
        - GoogleAuth: []
      tags:
        - AppUser
      parameters:
        - name: eventID
          type: integer
          format: int64
          required: true
          in: query
        - name: candidateID
          type: integer
          format: int64
          required: true
          in: query
      responses:
        '200':
          description: OK
          
  /appUserApi/v1/transferTicket:
    post:
      summary: Transfer your ticket
      description: Transfering ticket can be enabled/disabled in the manager console
      operationId: transferTicket
      security:
        - GoogleAuth: []
      tags:
        - AppUser
      parameters:
        - name: ticketId
          type: integer
          format: int64
          required: true
          in: query
        - name: transferToEmail
          type: string
          required: true
          in: query
        - name: transferToCell
          type: string
          required: true
          in: query
        - name: transferQuantity
          type: integer
          format: int32
          required: true
          in: query
      responses:
        '200':
          description: OK
          
  /appUserApi/v1/initializePaytmTransaction:
    post:
      summary: Initialize a paytm transaction
      description: Call this before making any payment
      operationId: initializePaytmTransaction
      security:
        - GoogleAuth: []
      tags:
        - AppUser
      parameters:
        - name: eventId
          type: integer
          format: int64
          required: true
          in: query
        - name: transferToEmail
          type: string
          required: true
          in: query
        - name: cellNo
          type: string
          required: true
          in: query
        - name: quantity
          type: integer
          format: int32
          required: true
          in: query
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/PaytmTransaction'
          
  /appUserApi/v1/PaytmTransactionSuccess:
    post:
      summary: Initialize a paytm transaction
      description: Call this before making any payment
      operationId: PaytmTransactionSuccess
      security:
        - GoogleAuth: []
      tags:
        - AppUser
      parameters:
        - name: OrderID
          type: string
          required: true
          in: query
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/Ticket'
  
  
  
definitions:
  
  MainEvent:
    title: MainEvent
    type: object
    description: Root level Main Event
    properties:
      id:
        type: integer
        format: int64
      positionInList:
        type: integer
        format: int32
      name:
        type: string
      description:
        type: string
      eventStart:
        type: integer
        format: int64
      eventEnd:
        type: integer
        format: int64
      ManagerEmail:
        type: string
      hasSingleCategory:
        type: boolean
        description: True if this Main Event has only one Category.
      hasSingleEvent:
        type: boolean
        description: True if this Main Event has only one Leaf Level Event.
      singleEventId:
        type: integer
        format: int64
      singleCategoryId:
        type: integer
        format: int64
      isPublished:
        type: boolean
      lat:
        type: number
        format: double
      lon:
        type: number
        format: double
      hashtag:
        type: string
      isTrending:
        type: boolean
      city:
        type: string
      isPaytmEnabled:
        type: boolean
      mainEventType:
        type: string
        enum:
          - COLLEGE
          - CONCERT
          - CLUB
      backdropUrl:
        type: string
 
  SortedMainEvents:
    type: object
    properties:
      trendingEvents:
        type: array
        items:
          $ref: '#/definitions/MainEvent'
      collegeEvents:
        type: array
        items:
          $ref: '#/definitions/MainEvent'
      clubEvents:
        type: array
        items:
          $ref: '#/definitions/MainEvent'
      concertEvents:
        type: array
        items:
          $ref: '#/definitions/MainEvent'
          
  Category:
    type: object
    properties:
      id:
        type: integer
        format: int64
      name:
        type: string
      parentMainEventId:
        type: integer
        format: int64
      isdefault:
        type: boolean
      isHidden:
        type: boolean
      backdropUrl:
        type: string

  Event:
    type: object
    properties:
      id:
        type: integer
        format: int64
      name:
        type: string
      description:
        type: string
      entryFee:
        type: integer
        format: int32
      parentMainEventId:
        type: integer
        format: int64
      parentCategoryId:
        type: integer
        format: int64
      multipleTicketsPerUser:
        type: boolean
      groupSize:
        type: integer
        format: int32
      registrable:
        type: boolean
      startTime:
        type: integer
        format: int64
      isVotingEnabled:
        type: boolean
      intrestType:
        type: string
      isEventTicketTransferable:
        type: boolean
      backdropUrl:
        type: string
      currentInvolvement:
        type: integer
        format: int32
      isCurrentUserIAMINED:
        type: boolean
      isCurrentUserHavingTicket:
        type: boolean
        
  UserRoles:
    type: object
    properties:
      isManagerForMainEvents:
        type: array
        items:
          $ref: '#/definitions/MainEvent'
      isPrForEvents:
        type: array
        items:
          $ref: '#/definitions/MainEvent'
      isEventHeadForEvents:
        type: array
        items:
          $ref: '#/definitions/Event'
      
    
        
  AppUser:
    type: object
    properties:
      id:
        type: string
        description: email id of the user
      contactNo:
        type: string
      name:
        type: string
      gender:
        type: boolean
        description: 1 for male 0 for female
      Institution:
        type: string
      city:
        type: string
      intrests:
        type: array
        items:
          type: string
      profilePic:
        type: string
        description: url to the profile picture
      regId:
        type: string
        description: Google Cloud Messaging Registration ID
        
  Manager:
    type: object
    properties:
      id:
        type: integer
        format: int64
      email:
        type: string
      MainEventListingId:
        type: integer
        format: int64
        
  PRRepresentative:
    type: object
    properties:
      id:
        type: integer
        format: int64
      email:
        type: string
      MainEventListingId:
        type: integer
        format: int64
      AmountCollected:
        type: integer
        format: int32
      lat:
        type: number
        format: double
      lon:
        type: number
        format: double
      locationUpdateTimestamp:
        type: number
        format: int64
        
  EventHead:
    type: object
    properties:
      id:
        type: integer
        format: int64
      email:
        type: string
      MainEventListingId:
        type: integer
        format: int64
      EventId:
        type: integer
        format: int64
        
  IAMIN:
    type: object
    properties:
      id:
        type: integer
        format: int64
      appUserEmail:
        type: string
      eventId:
        type: integer
        format: int64
      timeStamp:
        type: integer
        format: int64
      parentMainEventId:
        type: integer
        format: int64
      contactPreference:
        type: boolean
      requestQuantity:
        type: integer
        format: int32
      event:
        $ref: '#/definitions/Event'
      bearer:
        $ref: '#/definitions/AppUser'
        
  Ticket:
    type: object
    properties:
      id:
        type: integer
        format: int64
      appUserEmail:
        type: string
      eventId:
        type: integer
        format: int64
      timeStamp:
        type: integer
        format: int64
      PREmail:
        type: string
      activeQuantity:
        type: integer
        format: int32
      checkedInQuantity:
        type: integer
        format: int32
      parentMainEventId:
        type: integer
        format: int64
      event:
        $ref: '#/definitions/Event'
        
  EventLog:
    type: object
    properties:
      id:
        type: integer
        format: int64
      appUserEmail:
        type: string
      staffEmail:
        type: string
      MainEventListingId:
        type: integer
        format: int64
      EventId:
        type: integer
        format: int64
      timeStamp:
        type: integer
        format: int64
      paytmOrderId:
        type: string
      quantity:
        type: integer
        format: int32
      Amount:
        type: integer
        format: int32
      MainEventListingName:
        type: string
      EventName:
        type: string
      action:
        type: string
        enum:
          - CHECK_IN
          - BUY_TICKET
          - FREE_TICKET
          - TRANSFER_TICKET
          - BUY_TICKET_ONLINE
          
  Offer:
    type: object
    properties:
      id:
        type: integer
        format: int64
      offerType:
        type: string
        enum:
          - DIRECT_URL_OPEN
          - CALL_NUMBER
          - SHOW_CODE
          - SMS_NUMBER
      name:
        type: string
      positionInList:
        type: integer
      creativeUrl:
        type: string
      callToActionText:
        type: string
      redeemInstructions:
        type: string
      coupounCode:
        type: string
      callNumber:
        type: string
      smsText:
        type: string
      url:
        type: string
        
  Comment:
    type: object
    properties:
      id:
        type: integer
        format: int64
      timeStamp:
        type: integer
        format: int64
      eventID:
        type: integer
        format: int64
      senderEmail:
        type: string
      message:
        type: string
      senderProfilePic:
        type: string
      senderName:
        type: string
      isSenderManager:
        type: boolean
      isSenderEventHead:
        type: boolean
        
  Candidate:
    type: object
    properties:
      id:
        type: integer
        format: int64
      name:
        type: string
      eventID:
        type: integer
        format: int64
      votesAcquired:
        type: integer
        format: int64
        
  PaytmTransaction:
    type: object
    properties:
      ORDER_ID:
        type: string
      GENERATE_TIMESTAMP:
        type: integer
        format: int64
      TXN_AMOUNT:
        type: integer
        format: int32
      MOBILE_NO:
        type: string
      EMAIL:
        type: string
      ticketQuantity:
        type: integer
        format: int32
      eventId:
        type: integer
        format: int32
      isTicketIssued:
        type: boolean
      status:
        type: string
        enum:
          - INITIATED
          - SUCCESS
          - FAILED
      MID:
        type: string
      CHANNEL_ID:
        type: string
      INDUSTRY_TYPE_ID:
        type: string
      WEBSITE:
        type: string
      CUST_ID:
        type: string
